<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>내 로봇 관제 시스템</title>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/eventemitter2@6.4.9/lib/eventemitter2.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/roslib@1/build/roslib.min.js"></script>

<script type="text/javascript">
  // 페이지가 로딩되면 실행될 함수
  function init() {
    // 2. ROS 연결 객체 생성
    var ros = new ROSLIB.Ros({
      url : 'ws://localhost:9090' // 로봇과 같은 PC라면 localhost, 다르면 로봇 IP 입력
    });

    // 3. 연결 상태 모니터링
    ros.on('connection', function() {
      document.getElementById("status").innerHTML = "연결 성공! (Connected)";
      document.getElementById("status").style.color = "green";
      console.log('Connected to websocket server.');
    });

    ros.on('error', function(error) {
      document.getElementById("status").innerHTML = "에러 발생 (Error)";
      document.getElementById("status").style.color = "red";
      console.log('Error connecting to websocket server: ', error);
    });

    ros.on('close', function() {
      document.getElementById("status").innerHTML = "연결 끊김 (Closed)";
      console.log('Connection to websocket server closed.');
    });

    // 4. 예제: 현재 로봇의 속도(cmd_vel) 토픽을 발행하기 위한 객체 생성
    var cmdVel = new ROSLIB.Topic({
      ros : ros,
      name : '/cmd_vel',
      messageType : 'geometry_msgs/Twist'
    });

    // 앞으로 가는 메시지 정의
    var twist = new ROSLIB.Message({
      linear : { x : 0.1, y : 0.0, z : 0.0 },
      angular : { x : 0.0, y : 0.0, z : 0.0 }
    });

    // 버튼 클릭 시 호출될 함수
    window.moveRobot = function() {
        cmdVel.publish(twist);
        console.log("로봇에게 앞으로 가라고 명령했습니다!");
    }
  }
</script>
</head>

<body onload="init()">
  <h1>TurtleBot3 Web Controller</h1>
  
  <h3>상태: <span id="status" style="color:gray;">연결 중...</span></h3>

  <hr/>

  <button onclick="moveRobot()" style="padding: 10px 20px; font-size: 16px;">
    로봇 앞으로 조금 전진 (Move Forward)
  </button>
  
  <p>F12를 눌러 콘솔(Console) 창도 확인해보세요.</p>
</body>
</html>